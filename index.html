<script>
  function onScanSuccess(decodedText, decodedResult) {
    console.log("Resultado del escaneo:", decodedText);
    document.getElementById("qr-reader-results").innerText = "Orden: " + decodedText;
    
    var driverName = document.getElementById("driverName").value;
    console.log("Nombre del chofer ingresado:", driverName);
    if (!driverName) {
      alert("Por favor, ingresa tu nombre antes de escanear.");
      return;
    }
    
    console.log("Enviando datos al endpoint...");
    fetch("https://script.google.com/macros/s/AKfycbz4HAbGp_GfDO-H5bkotPgCzeo_eV5ORiKCsOJtwnipDeqbgkRH8bKjKs6j7nzanfh3/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        orderNumber: decodedText,
        chofer: driverName
      })
    })
    .then(response => {
      console.log("HTTP status:", response.status);
      return response.json();
    })
    .then(data => {
      console.log("Respuesta del servidor:", data);
      if (data.result === "success") {
        alert("Registro exitoso");
      } else {
        alert("Error: " + data.message);
      }
    })
    .catch(error => {
      console.error("Error en fetch:", error);
    });
  }
  
  function onScanFailure(error) {
    console.warn("Error en el escaneo:", error);
  }
  
  let html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
  html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>
